machine:
  xcode:
    version: "7.0"

dependencies:
  pre:
    - brew install uncrustify
    - sudo gem install cocoapods -N -v 0.37.2
    - sudo gem uninstall cocoapods -v '>0.37.2' --force || true

test:
  override:
    - xctool -workspace objcTox.xcworkspace -scheme OSXDemo -sdk macosx10.10 CODE_SIGNING_REQUIRED=NO clean test

    - xctool
      -workspace objcTox.xcworkspace
      -scheme iOSDemo
      -sdk iphonesimulator
      CODE_SIGNING_REQUIRED=NO
      GCC_INSTRUMENT_PROGRAM_FLOW_ARCS=YES
      GCC_GENERATE_TEST_COVERAGE_FILES=YES
      clean
      test

    - ./run-uncrustify.sh --check

deployment:
  codecov:
    branch: /.*/
    commands:
      - bash <(curl -s https://codecov.io/bash)
