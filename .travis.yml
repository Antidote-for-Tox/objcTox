language: objective-c
osx_image: xcode7.2

before_install:
  - gem install cocoapods -v 1.0.0.beta.3
  - brew install uncrustify

install:
  - pod _1.0.0.beta.3_ install

script:
  - xctool -workspace objcTox.xcworkspace -scheme OSXDemo -sdk macosx10.11 CODE_SIGNING_REQUIRED=NO clean test

  - xctool
    -workspace objcTox.xcworkspace
    -scheme iOSDemo
    -sdk iphonesimulator
    CODE_SIGNING_REQUIRED=NO
    GCC_INSTRUMENT_PROGRAM_FLOW_ARCS=YES
    GCC_GENERATE_TEST_COVERAGE_FILES=YES
    clean
    test

  - ./run-uncrustify.sh --check

after_success:
  - bash <(curl -s https://codecov.io/bash)
